k<-4
q<-1
x=runif(20)
d<-abs(x-x[q])
c<-sort(d)[k+1]
nn<-rep('',20)
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug()
set.seed(5)
k<-4
q<-1
x=runif(20)
d<-abs(x-x[q])
c<-sort(d)[k+1]
nn<-rep('',20)
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug(size=2)+theme(legend.position = 'none')
nn
set.seed(5)
k<-4
q<-1
x=runif(20)
d<-abs(x-x[q])
c<-sort(d)[k+1]
nn<-rep('-',20)
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug(size=2)+theme(legend.position = 'none')
set.seed(5)
k<-4
q<-1
x=runif(20)
d<-abs(x-x[q])
c<-sort(d)[k+1]
nn<-rep('x',20)
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug(size=2)+theme(legend.position = 'none')
set.seed(5)
k<-4
q<-1
x=runif(20)
d<-abs(x-x[q])
c<-sort(d)[k+1]
nn<-rep('x',20)
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug(size=1)+theme(legend.position = 'none')
set.seed(6)
k<-4
q<-1
x=runif(20)
d<-abs(x-x[q])
c<-sort(d)[k+1]
nn<-rep('x',20)
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug(size=1)+theme(legend.position = 'none')
set.seed(6)
k<-4
q<-1
x=runif(20)
d<-abs(x-x[q])
c<-sort(d)[k+1]
nn<-rep('x',20)
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug(size=1)+theme(legend.position = 'none')+scale_color_manual(c("#E69F00", "#56B4E9", "#009E73"))
set.seed(6)
k<-4
q<-1
x=runif(20)
d<-abs(x-x[q])
c<-sort(d)[k+1]
nn<-rep('x',20)
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug(size=1)+theme(legend.position = 'none')+scale_color_manual(values = c("#E69F00", "#56B4E9", "#009E73"))
set.seed(6)
k<-4
q<-1
x=runif(20)
y=runif(20)
d<-abs(x-x[q])
c<-sort(d)[k+1]
nn<-rep('x',20)
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug(size=1)+theme(legend.position = 'none')+scale_color_manual(values = c("#56B4E9", "#009E73"))+geom_point(aes(y=y))
?subset
set.seed(6)
k<-4
q<-1
x=runif(20)
y=runif(20)
d<-abs(x-x[q])
c<-sort(d)[k+1]
nn<-rep('x',20)
nn[q]<-'x0'
df<-tibble(x=x,y=y,nn=nn)
ggplot(df,aes(x=x,col=nn))+geom_rug(size=1)+theme(legend.position = 'none')+scale_color_manual(values = c("#56B4E9", "#009E73"))#+geom_point(data = df[2:20,],mapping = aes(x=x,y=y))
set.seed(6)
k<-4
q<-1
x=runif(20)
y=runif(20)
d<-abs(x-x[q])
c<-sort(d)[k+1]
nn<-rep('x',20)
nn[q]<-'x0'
df<-tibble(x=x,y=y,nn=nn)
ggplot(df,aes(x=x,col=nn))+geom_rug(size=1)+theme(legend.position = 'none')+scale_color_manual(values = c("#56B4E9", "#009E73"))+geom_point(data = df[2:20,],mapping = aes(x=x,y=y))
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug(size=1)+theme(legend.position = 'none')+scale_color_manual(values = c("#E69F00", "#56B4E9", "#009E73"))+geom_point(data = df[2:20,],mapping = aes(x=x,y=y))
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug(size=1)+theme(legend.position = 'none')+scale_color_manual(values = c("#E69F00", "#56B4E9", "#009E73"))+geom_point(data = df[2:20,],mapping = aes(x=x,y=y,col=nn))
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
tibble(x=x,nn=nn)%>%
ggplot(aes(x=x,col=nn))+geom_rug(size=1)+theme(legend.position = 'none')+geom_point(data = df[2:20,],mapping = aes(x=x,y=y,col=nn))+scale_color_manual(values = c("#E69F00", "#56B4E9", "#009E73"))
nn[(d<=c)]<-'nn'
nn[q]<-'x0'
df<-tibble(x=x,y=y,nn=nn)
ggplot(df,aes(x=x,col=nn))+geom_rug(size=1)+theme(legend.position = 'none')+geom_point(data = df[2:20,],mapping = aes(x=x,y=y,col=nn))+scale_color_manual(values = c("#E69F00", "#56B4E9", "#009E73"))
xaringan:::inf_mr()
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, fig.align = "center")
require(magrittr)
require(tidyverse)
require(plotly)
require(widgetframe)
require(animation)
require(DT)
require(PoEdata)
require(kableExtra)
require(gridExtra)
require(ggmosaic)
require(ggthemes)
ggplot(df,aes(x=x,col=nn))+geom_rug(size=1.5)+theme(legend.position = 'none')+geom_point(data = df[2:20,],mapping = aes(x=x,y=y,col=nn),size=3)+scale_color_manual(values = c("#E69F00", "#56B4E9", "#009E73"))+geom_smooth(data = filter(df,nn='nn'),method = 'lm',se = F)
ggplot(df,aes(x=x,col=nn))+geom_rug(size=1.5)+theme(legend.position = 'none')+geom_point(data = df[2:20,],mapping = aes(x=x,y=y,col=nn),size=3)+scale_color_manual(values = c("#E69F00", "#56B4E9", "#009E73"))+geom_smooth(data = filter(df,nn=='nn'),method = 'lm',se = F)
lmloc<-lm(data = filter(df,nn=='nn'))
lmloc<-lm(data = filter(df,nn=='nn'),y~x)
lmloc
predict.lm(lmloc,0.5)
predict.lm(lmloc,newdata = filter(df,nn==x0))
predict.lm(lmloc,newdata = filter(df,nn=='x0'))
?geom_point
geom_smooth()
?geom_smooth()
?loess
?gam
?annotate
library(tidyverse)
m<-ggplot(diamonds,aes(x=carat,y=price))+geom_points()
m<-ggplot(diamonds,aes(x=carat,y=price))+geom_point()
m
m<-ggplot(diamonds,aes(x=carat,y=price))+geom_density2d()
m
m+geom_point()
rm(list=ls())
p1<-ggplot(diamonds,aes(x=carat,y=price))+geom_density2d()
p2<-ggplot(diamonds,aes(x=carat,y=price))+geom_point()+geom_density2d()
p1
p2
library(ggplot2)
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, fig.align = "center")
require(magrittr)
require(tidyverse)
require(plotly)
require(widgetframe)
require(animation)
require(DT)
require(PoEdata)
require(kableExtra)
require(gridExtra)
require(ggmosaic)
require(ggthemes)
Credit<-readRDS('Credit.rds')
Credit
set.seed(1)
Credit<-readRDS('Credit.rds')%>%sample_n(100)
ggplot(Credit,aes(x=LIMIT_BAL,y=AGE,col=default))+geom_point()
setwd("~/Documents/Teaching/DataVizA2019/Lectures/09kNNClassifier")
install.packages("class")
?knn
library(class)
?knn
?outer
1:100 %o% c('a','b')
?crossprod
expand.grid(1:100,c('a','b'))
?grid.expand
?expand.grid
rbinom(100,1,0.5)
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, fig.align = "center")
require(magrittr)
require(tidyverse)
require(plotly)
require(widgetframe)
require(animation)
require(DT)
require(PoEdata)
require(kableExtra)
require(gridExtra)
require(ggmosaic)
require(ggthemes)
gx1<-seq(1,500000, by=10000)
gx2<-seq(1,60, by=10)
grid<-expand.grid(gx1,gx2)
grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
grid
Credit
colnames(Credit)
?knn
iris3
gx1<-seq(10000,500000, by=10000)
gx2<-seq(10,60, by=10)
grid<-expand.grid(gx1,gx2)
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
train<-Credit[,c(2,6,25)]
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(Credit[,c(2,6)],test = grid,cl = Credit[,25])
Credit[,c(2,6)]
Credit[,25]
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(Credit[,c(2,6)],test = grid,cl = Credit[,25])
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(train = Credit[,c(2,6)],test = grid,cl = Credit[,25])
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(train = as.matrix(Credit[,c(2,6)]),test = grid,cl = Credit[,25])
as.matrix(Credit[,c(2,6)])
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(train = as.matrix(Credit[,c(2,6)]),test = grid,cl = as.vector(Credit[,25]))
train <- rbind(iris3[1:25,,1], iris3[1:25,,2], iris3[1:25,,3])
train
cl <- factor(c(rep("s",25), rep("c",25), rep("v",25)))
str(cl)
length(cl)
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(train = as.matrix(Credit[,c(2,6)]),test = grid,cl = as.factor(Credit[,25]))
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(train = Credit[,c(2,6)],test = grid,cl = as.factor(Credit[,25]))
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(train = Credit[,c(2,6)],test = grid,cl = as.factor(pull(Credit,25)))
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(train = Credit[,c(2,6)],test = grid,cl = as.factor(pull(Credit,25)))->out
dim(out)
length(out)
length(grid)
dim(grid)
cbind(grid,out)%>%
tibble%>%View
grid%>%
tibble%>%View
grid%>%
tibble->o
o
o$.
colnames(grid)<-c('Limit','Age')
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(train = Credit[,c(2,6)],test = grid,cl = as.factor(pull(Credit,25)))->out
grid
tibble(grid)%>%View
grid%>%View()
as_tibble(grid)%>%View
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=class))+geom_point()
grid%>%
as_tibble%>%
add_column(Class=out)%>%View
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=class))+geom_point()
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=class))+geom_point()
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point()
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point()
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point()
expand.grid()
grid()
grid
gx1<-seq(1000,500000, by=1000)
gx2<-seq(0.1,60, by=0.1)
grid<-expand.grid(gx1,gx2)
grid
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(train = Credit[,c(2,6)],test = grid,cl = as.factor(pull(Credit,25)),k = 1)->out
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point(size=0.01)+scale_color_colorblind()
gx1<-seq(1000,500000, by=1000)
grid<-expand.grid(gx1,gx2)
colnames(grid)<-c('Limit','Age')
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
knn(train = Credit[,c(2,6)],test = grid,cl = as.factor(pull(Credit,25)),k = 1)->out
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point(size=0.01)+scale_color_colorblind()
Credit[,c(2,6)]
grid%>%
as_tibble%>%
add_column(Class=out)%>%View
?knn
?scale
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
select(Credit,LIMIT_BAL,AGE)%>%scale->tr
tr
grid
tr
attr(tr)
attr(tr,"scaled:scale")
scale(grid,center = attr(tr,"scaled:center") ,scale = attr(tr,"scaled:scale") )
gx1<-seq(10000,500000, by=10000)
gx2<-seq(5,60, by=5)
grid<-expand.grid(gx1,gx2)
colnames(grid)<-c('Limit','Age')
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
select(Credit,LIMIT_BAL,AGE)%>%scale->tr
ts<-scale(grid,center = attr(tr,"scaled:center") ,scale = attr(tr,"scaled:scale") )
knn(tr, ts,cl = as.factor(pull(Credit,25)),k = 1)->out
grid%>%
as_tibble%>%
add_column(Class=out)%>%View
knn.cv(tr, ts,cl = as.factor(pull(Credit,25)))->out
?knn.cv
ts
tr
knn.cv(tr, cl = as.factor(pull(Credit,25)))->optk
optk
knn.cv(tr, cl = as.factor(pull(Credit,25)))->optk
mean(as.factor(pull(Credit,25))-optk)
mean(as.factor(pull(Credit,25))==optk)
kk<-1
knn.cv(tr, cl = as.factor(pull(Credit,25)),k=kk)->optk
mean(as.factor(pull(Credit,25))==optk)
store<-rep(0,100)
for (kk in 1:100){
knn.cv(tr, cl = as.factor(pull(Credit,25)),k=kk)->optk
store[kk]<-mean(as.factor(pull(Credit,25))==optk)
}
store<-rep(0,99)
for (kk in 1:99){
knn.cv(tr, cl = as.factor(pull(Credit,25)),k=kk)->optk
store[kk]<-mean(as.factor(pull(Credit,25))==optk)
}
store
plot(store)
plot(store,'l')
plot(1:99,store,'l')
as.factor(pull(Credit,25))
(as.factor(pull(Credit,25))=="No Default")
sum(as.factor(pull(Credit,25))=="No Default")
store
?class
readRDS('Credit.rds')
readRDS('Credit.rds')->CC
Credit
CC
CC%>%sample_frac(500)%>%select(LIMIT_BAL,AGE,default)->sub
CC%>%sample_n(500)%>%select(LIMIT_BAL,AGE,default)->sub
sub
train_all<-sub[1:250,]
test_all<-sub[251:500,]
train_all
train_all%>%select(-default)->train_x
test_all%>%select(-default)->test_x
train_all%>%pull(default)%>%as.factor->train_y
test_all%>%pull(default)%>%as.factor->test_y
knn(train = train_x,test = test_x,cl = train_y,k = 1)
knn(train = train_x,test = test_x,cl = train_y,k = 2)
?save
save(list=c('train_x,train_y,test_x,test_y'),file='knnexample.RData')
save(list=c('train_x','train_y','test_x','test_y'),file='knnexample.RData')
rm(list-ls())
rm(list=ls())
load('knnexample.RData')
train_x_std<-scale(train_x)
train_x_std
?knn
print(outkn )
knn(train_x_std,
test_x_std,
train_y,k=1)->outknn
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, fig.align = "center")
require(magrittr)
require(tidyverse)
require(plotly)
require(widgetframe)
require(animation)
require(DT)
require(PoEdata)
require(kableExtra)
require(gridExtra)
require(ggmosaic)
require(ggthemes)
set.seed(1)
Credit<-readRDS('Credit.rds')%>%sample_n(100)
g<-ggplot(Credit,aes(x=LIMIT_BAL,y=AGE,col=default))+geom_point()+scale_color_colorblind()
g
g+geom_point(aes(x=350000,50),color='#339966',shape=4,size=10)
g+geom_point(aes(x=50000,45),color='#339966',shape=4,size=10)
g+geom_point(aes(x=350000,50),color='#339966',shape=4,size=10)
g+geom_point(aes(x=350000,50),color='#339966',shape=4,size=10)+geom_point(aes(x=350000,50),color='#339966',shape=1,size=45)
g+geom_point(aes(x=50000,45),color='#339966',shape=4,size=10)
g+geom_point(aes(x=50000,45),color='#339966',shape=4,size=10)+geom_point(aes(x=50000,45),color='#339966',shape=1,size=25)
g+geom_point(aes(x=350000,50),color='#339966',shape=4,size=10)+geom_point(aes(x=350000,50),color='#339966',shape=1,size=110)
g+geom_point(aes(x=50000,45),color='#339966',shape=4,size=10)+geom_point(aes(x=50000,45),color='#339966',shape=1,size=45)
grid<-Credit[,c(2,6)]
colnames(grid)<-c('Limit','Age')
grid%>%
as_tibble()%>%
add_column(Class=as.factor(pull(Credit,25)))%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point()+scale_color_colorblind()
library(class)
gx1<-seq(10000,500000, by=10000)
gx2<-seq(20.5,60, by=0.5)
grid<-expand.grid(gx1,gx2)
colnames(grid)<-c('Limit','Age')
#grid<-cbind(grid,rbinom(nrow(grid),1,0.5))
select(Credit,LIMIT_BAL,AGE)%>%scale->tr
ts<-scale(grid,center = attr(tr,"scaled:center") ,scale = attr(tr,"scaled:scale") )
knn(tr, ts,cl = as.factor(pull(Credit,25)),k = 1)->out
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point(size=1)+scale_color_colorblind()
knn(tr, ts,cl = as.factor(pull(Credit,25)),k = 3)->out
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point(size=1)+scale_color_colorblind()
knn(tr, ts,cl = as.factor(pull(Credit,25)),k = 11)->out
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point(size=1)+scale_color_colorblind()
knn(tr, ts,cl = as.factor(pull(Credit,25)),k = 17)->out
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point(size=1)+scale_color_colorblind()
knn(tr, ts,cl = as.factor(pull(Credit,25)),k = 3)->out
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point(size=1)+scale_color_colorblind()
set.seed(2)
Credit2<-readRDS('Credit.rds')%>%sample_n(100)
select(Credit2,LIMIT_BAL,AGE)%>%scale->tr2
ts2<-scale(grid,center = attr(tr2,"scaled:center") ,scale = attr(tr2,"scaled:scale") )
knn(tr2, ts2,cl = as.factor(pull(Credit2,25)),k = 3)->out
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point(size=1)+scale_color_colorblind()
knn(tr, ts,cl = as.factor(pull(Credit,25)),k = 11)->out
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point(size=1)+scale_color_colorblind()
knn(tr2, ts2,cl = as.factor(pull(Credit2,25)),k = 11)->out
grid%>%
as_tibble%>%
add_column(Class=out)%>%
ggplot(aes(x=Limit,y=Age,col=Class))+geom_point(size=1)+scale_color_colorblind()
load('knnexample.RData')
train_x_std<-scale(train_x)
mean_train_x<-attr(train_x_std,"scaled:center")
std_train_x<-attr(train_x_std,"scaled:scale")
test_x_std<-scale(test_x,
center = mean_train_x,
scale = std_train_x)
knn(train_x_std,
test_x_std,
train_y,k=1)->outknn
str(outknn)
print(outknn)
knn(train_x_std,
test_x_std,
train_y,k=5,prob = TRUE)->yhat_k5
yhat_k5
?attr
